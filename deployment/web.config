<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    
    <!-- ISAPI Filter Configuration -->
    <isapiFilters>
      <!-- Replace 'YourISAPIFilter.dll' with your actual DLL name -->
      <filter name="DelphiISAPIFilter" 
              path="bin\YourISAPIFilter.dll" 
              enabled="true" 
              enableCache="true" />
    </isapiFilters>
    
    <!-- Handler Mappings for ISAPI -->
    <handlers>
      <!-- ISAPI-dll handler mapping -->
      <add name="ISAPI-dll" 
           path="*.dll" 
           verb="GET,HEAD,POST" 
           modules="IsapiModule" 
           scriptProcessor="" 
           resourceType="File" 
           requireAccess="Execute" 
           allowPathInfo="true" />
      
      <!-- Custom ISAPI handler for specific extensions -->
      <add name="DelphiISAPI" 
           path="*.dapi" 
           verb="*" 
           modules="IsapiModule" 
           scriptProcessor="bin\YourISAPIFilter.dll" 
           resourceType="File" 
           requireAccess="Execute" />
    </handlers>
    
    <!-- Default Documents -->
    <defaultDocument>
      <files>
        <clear />
        <add value="default.htm" />
        <add value="default.html" />
        <add value="default.asp" />
        <add value="index.html" />
        <add value="iisstart.htm" />
      </files>
    </defaultDocument>
    
    <!-- Directory Browsing -->
    <directoryBrowse enabled="false" />
    
    <!-- Request Filtering -->
    <security>
      <requestFiltering>
        <fileExtensions>
          <add fileExtension=".dll" allowed="true" />
          <add fileExtension=".dapi" allowed="true" />
        </fileExtensions>
        <verbs>
          <add verb="GET" allowed="true" />
          <add verb="POST" allowed="true" />
          <add verb="HEAD" allowed="true" />
        </verbs>
        <requestLimits maxAllowedContentLength="104857600" /> <!-- 100MB -->
      </requestFiltering>
    </security>
    
    <!-- Static Content -->
    <staticContent>
      <mimeMap fileExtension=".dapi" mimeType="application/octet-stream" />
    </staticContent>
    
    <!-- HTTP Errors -->
    <httpErrors errorMode="Detailed" />
    
    <!-- URL Rewrite (if needed for legacy URL compatibility) -->
    <!--
    <rewrite>
      <rules>
        <rule name="Legacy ISAPI URLs" stopProcessing="true">
          <match url="^legacy/(.*)$" />
          <action type="Rewrite" url="YourISAPIFilter.dll?{R:1}" />
        </rule>
      </rules>
    </rewrite>
    -->
    
  </system.webServer>
  
  <!-- Application Settings -->
  <appSettings>
    <!-- Custom settings for your ISAPI filter -->
    <add key="ISAPI_DEBUG_MODE" value="false" />
    <add key="ISAPI_LOG_LEVEL" value="INFO" />
    <add key="SHARED_FOLDER_PATH" value="D:\home\shared" />
    
    <!-- Azure-specific settings -->
    <add key="WEBSITE_LOAD_USER_PROFILE" value="1" />
    <add key="WEBSITE_DYNAMIC_CACHE" value="0" />
  </appSettings>
  
  <!-- Connection Strings (if needed) -->
  <connectionStrings>
    <!-- Example connection string for database access -->
    <!--
    <add name="DefaultConnection" 
         connectionString="Data Source=your-server;Initial Catalog=your-database;Integrated Security=true" 
         providerName="System.Data.SqlClient" />
    -->
  </connectionStrings>
  
  <!-- System.Web Configuration for .NET Framework compatibility -->
  <system.web>
    <compilation debug="false" targetFramework="4.8" />
    <httpRuntime targetFramework="4.8" maxRequestLength="102400" executionTimeout="300" />
    
    <!-- Trust Level -->
    <trust level="Full" />
    
    <!-- Session State (if used by ISAPI) -->
    <sessionState mode="InProc" 
                  cookieless="false" 
                  timeout="20" />
    
    <!-- Custom Errors -->
    <customErrors mode="Off" />
    
    <!-- Authentication (adjust as needed) -->
    <authentication mode="None" />
    
    <!-- Authorization -->
    <authorization>
      <allow users="*" />
    </authorization>
  </system.web>
  
  <!-- Runtime configuration -->
  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <!-- Assembly redirects if needed -->
    </assemblyBinding>
  </runtime>
  
</configuration>
